<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2025a"><title>Untitled</title><style type="text/css">.rtcContent { padding: 30px; } .CodeBlock { background-color: #F5F5F5; margin: 10px 15px 10px 0; display: inline-block; min-width: 100%; }
.S0 { border-left: 0.8px solid rgb(217, 217, 217); border-right: 0.8px solid rgb(217, 217, 217); border-top: 0.8px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S1 { border-left: 0.8px solid rgb(217, 217, 217); border-right: 0.8px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S2 { border-left: 0.8px solid rgb(217, 217, 217); border-right: 0.8px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0.8px solid rgb(217, 217, 217); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S0'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Panel Nomograph using a Surrogate Model from XGBoost Data</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% This script reads data from a CSV, fits a second-order polynomial</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% surrogate model, assesses its accuracy, and then creates an interactive</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% 2D nomograph. The nomograph allows you to visualize the relationship</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% between key variables and find predicted values.</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >clc; close </span><span style="color: rgb(167, 9, 245);">all</span><span >; clear;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- 1. Data Loading from CSV ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Assuming the CSV file is in the same directory as this script.</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">try</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Use 'VariableNamingRule', 'preserve' to keep original column names</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    data = readtable(</span><span style="color: rgb(167, 9, 245);">'xgb_generated_predictions.csv'</span><span >, </span><span style="color: rgb(167, 9, 245);">'VariableNamingRule'</span><span >, </span><span style="color: rgb(167, 9, 245);">'preserve'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    fprintf(</span><span style="color: rgb(167, 9, 245);">'Successfully loaded data from xgb_generated_predictions.csv\n'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">catch</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    error(</span><span style="color: rgb(167, 9, 245);">'Error: Could not read the CSV file. Please ensure xgb_generated_predictions.csv is in the same directory.'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- 2. Define Predictors and Response for Surrogate Model ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >R_data = data.Radius;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >Lc_data = data.Lc;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >e_data = data.(</span><span style="color: rgb(167, 9, 245);">'e (%)'</span><span >); </span><span style="color: rgb(0, 128, 19);">% Referencing the column name with special characters</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >y_data = data.DWI_PCA_Predicted;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- 3. Fit a Second-Order Polynomial Surrogate Model ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% A second-order polynomial is a good choice as it is a single, explicit</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% mathematical equation that can approximate the non-linear behavior of an</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% XGBoost model. It includes linear, quadratic, and interaction terms.</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >mdl = fitlm(table(R_data, Lc_data, e_data, y_data, </span><span style="color: rgb(167, 9, 245);">'VariableNames'</span><span >, {</span><span style="color: rgb(167, 9, 245);">'R'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Lc'</span><span >, </span><span style="color: rgb(167, 9, 245);">'e'</span><span >, </span><span style="color: rgb(167, 9, 245);">'y'</span><span >}), </span><span style="color: rgb(167, 9, 245);">'y ~ R*Lc + R*e + Lc*e + R^2 + Lc^2 + e^2'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'\nSurrogate Model (Second-Order Polynomial):\n'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >disp(mdl);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- Add code to display the regression equation as a string ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'\nRegression Equation:\n'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >coeffs = mdl.Coefficients;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Start the string with the intercept term.</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >equation_str = sprintf(</span><span style="color: rgb(167, 9, 245);">'y = %.4f'</span><span >, coeffs.Estimate(1));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Loop through the rest of the coefficients</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">for </span><span >i = 2:size(coeffs, 1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Get the coefficient estimate and its name</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    estimate = coeffs.Estimate(i);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    term_name = coeffs.Properties.RowNames{i};</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Clean up the term name for display (e.g., 'R:Lc' to 'R*Lc', 'R^2' to 'R^2')</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    term_name = strrep(term_name, </span><span style="color: rgb(167, 9, 245);">':'</span><span >, </span><span style="color: rgb(167, 9, 245);">'*'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Format the term based on its sign</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">if </span><span >estimate &gt;= 0</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        term_str = sprintf(</span><span style="color: rgb(167, 9, 245);">' + %.4f * %s'</span><span >, estimate, term_name);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        term_str = sprintf(</span><span style="color: rgb(167, 9, 245);">' - %.4f * %s'</span><span >, abs(estimate), term_name);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    equation_str = [equation_str, term_str];</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'%s\n\n'</span><span >, equation_str);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- 4. Assess and Report Model Accuracy ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >R2_surrogate = mdl.Rsquared.Ordinary;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >RMSE_surrogate = mdl.RMSE;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'Statistical Metrics for Surrogate Model:\n'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'  R-squared (R^2): %.4f\n'</span><span >, R2_surrogate);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(167, 9, 245);">'  Root Mean Squared Error (RMSE): %.4f\n\n'</span><span >, RMSE_surrogate);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% --- 5. Generate an Interactive 2D Nomograph Plot ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >figure(</span><span style="color: rgb(167, 9, 245);">'Name'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Interactive 2D Nomograph'</span><span >, </span><span style="color: rgb(167, 9, 245);">'NumberTitle'</span><span >, </span><span style="color: rgb(167, 9, 245);">'off'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Position'</span><span >, [100, 100, 1000, 700]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >ax = axes(</span><span style="color: rgb(167, 9, 245);">'Parent'</span><span >, gcf, </span><span style="color: rgb(167, 9, 245);">'Units'</span><span >, </span><span style="color: rgb(167, 9, 245);">'normalized'</span><span >, </span><span style="color: rgb(167, 9, 245);">'OuterPosition'</span><span >, [0.1, 0.2, 0.8, 0.7]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >hold(ax, </span><span style="color: rgb(167, 9, 245);">'on'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >grid(ax, </span><span style="color: rgb(167, 9, 245);">'on'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >box(ax, </span><span style="color: rgb(167, 9, 245);">'on'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >xlabel(ax, </span><span style="color: rgb(167, 9, 245);">'Radius (R)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >ylabel(ax, </span><span style="color: rgb(167, 9, 245);">'Lc (Ls)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >title(ax, </span><span style="color: rgb(167, 9, 245);">'Interactive Nomograph for DWI_PCA_Predicted'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >set(ax, </span><span style="color: rgb(167, 9, 245);">'FontSize'</span><span >, 12);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >R_range = linspace(min(R_data), max(R_data), 50);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >Lc_range = linspace(min(Lc_data), max(Lc_data), 50);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >e_range = linspace(min(e_data), max(e_data), 50);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >[R_grid, Lc_grid] = meshgrid(R_range, Lc_range);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Create slider for 'e' variable</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >e_slider = uicontrol(</span><span style="color: rgb(167, 9, 245);">'Parent'</span><span >, gcf, </span><span style="color: rgb(167, 9, 245);">'Style'</span><span >, </span><span style="color: rgb(167, 9, 245);">'slider'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Min'</span><span >, min(e_data), </span><span style="color: rgb(167, 9, 245);">'Max'</span><span >, max(e_data), </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(167, 9, 245);">'Value'</span><span >, median(e_data), </span><span style="color: rgb(167, 9, 245);">'Position'</span><span >, [200, 50, 600, 20]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >e_slider_label = uicontrol(</span><span style="color: rgb(167, 9, 245);">'Parent'</span><span >, gcf, </span><span style="color: rgb(167, 9, 245);">'Style'</span><span >, </span><span style="color: rgb(167, 9, 245);">'text'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Position'</span><span >, [100, 50, 80, 20], </span><span style="color: rgb(167, 9, 245);">'String'</span><span >, </span><span style="color: rgb(167, 9, 245);">'e (%)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >e_slider_value = uicontrol(</span><span style="color: rgb(167, 9, 245);">'Parent'</span><span >, gcf, </span><span style="color: rgb(167, 9, 245);">'Style'</span><span >, </span><span style="color: rgb(167, 9, 245);">'text'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Position'</span><span >, [810, 50, 80, 20], </span><span style="color: rgb(167, 9, 245);">'String'</span><span >, sprintf(</span><span style="color: rgb(167, 9, 245);">'%.2f'</span><span >, median(e_data)));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Create the plot container</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >h_plot = surf(ax, R_grid, Lc_grid, zeros(size(R_grid))); </span><span style="color: rgb(0, 128, 19);">% Initialize with zero height</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >set(h_plot, </span><span style="color: rgb(167, 9, 245);">'EdgeColor'</span><span >, </span><span style="color: rgb(167, 9, 245);">'none'</span><span >, </span><span style="color: rgb(167, 9, 245);">'FaceColor'</span><span >, </span><span style="color: rgb(167, 9, 245);">'interp'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Callback function for the slider to update the plot</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >e_slider.Callback = @(src, event) updateNomograph2D(src.Value, R_grid, Lc_grid, mdl, ax, e_slider_value, h_plot);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% Initial plot</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >current_e = median(e_data);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >updateNomograph2D(current_e, R_grid, Lc_grid, mdl, ax, e_slider_value, h_plot);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% The updateNomograph2D function for the 2D plot</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">function </span><span >updateNomograph2D(e_value, R_grid, Lc_grid, mdl, ax, e_slider_value_handle, h_plot_handle)</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Calculate the predicted DWI_PCA values for the current 'e' value</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    e_grid = repmat(e_value, size(R_grid));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Use the surrogate model to predict the DWI_PCA values</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    y_pred = predict(mdl, table(R_grid(:), Lc_grid(:), e_grid(:), </span><span style="color: rgb(167, 9, 245);">'VariableNames'</span><span >, {</span><span style="color: rgb(167, 9, 245);">'R'</span><span >, </span><span style="color: rgb(167, 9, 245);">'Lc'</span><span >, </span><span style="color: rgb(167, 9, 245);">'e'</span><span >}));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    y_pred_grid = reshape(y_pred, size(R_grid));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Update the plot data</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    set(h_plot_handle, </span><span style="color: rgb(167, 9, 245);">'ZData'</span><span >, y_pred_grid, </span><span style="color: rgb(167, 9, 245);">'CData'</span><span >, y_pred_grid);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Get the fitted values to determine the consistent color scale</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    fitted_values = mdl.Fitted;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    caxis(ax, [min(fitted_values), max(fitted_values)]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Add the color bar to act as the third axis for the predicted values</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    h_cb = colorbar(ax, </span><span style="color: rgb(167, 9, 245);">'Location'</span><span >, </span><span style="color: rgb(167, 9, 245);">'eastoutside'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    ylabel(h_cb, </span><span style="color: rgb(167, 9, 245);">'Predicted DWI_PCA'</span><span >, </span><span style="color: rgb(167, 9, 245);">'FontSize'</span><span >, 12);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    colormap(ax, </span><span style="color: rgb(167, 9, 245);">'jet'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Set plot properties</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    xlabel(ax, </span><span style="color: rgb(167, 9, 245);">'Radius (R)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    ylabel(ax, </span><span style="color: rgb(167, 9, 245);">'Lc (Ls)'</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    title(ax, sprintf(</span><span style="color: rgb(167, 9, 245);">'Nomograph for DWI_PCA_Predicted (e = %.2f %%)'</span><span >, e_value));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Update the slider value text</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    set(e_slider_value_handle, </span><span style="color: rgb(167, 9, 245);">'String'</span><span >, sprintf(</span><span style="color: rgb(167, 9, 245);">'%.2f'</span><span >, e_value));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'>&nbsp;</div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
% Panel Nomograph using a Surrogate Model from XGBoost Data
% This script reads data from a CSV, fits a second-order polynomial
% surrogate model, assesses its accuracy, and then creates an interactive
% 2D nomograph. The nomograph allows you to visualize the relationship
% between key variables and find predicted values.
clc; close all; clear;

% REPLACE_WITH_DASH_DASH- 1. Data Loading from CSV REPLACE_WITH_DASH_DASH-
% Assuming the CSV file is in the same directory as this script.
try
    % Use 'VariableNamingRule', 'preserve' to keep original column names
    data = readtable('xgb_generated_predictions.csv', 'VariableNamingRule', 'preserve');
    fprintf('Successfully loaded data from xgb_generated_predictions.csv\n');
catch
    error('Error: Could not read the CSV file. Please ensure xgb_generated_predictions.csv is in the same directory.');
end

% REPLACE_WITH_DASH_DASH- 2. Define Predictors and Response for Surrogate Model REPLACE_WITH_DASH_DASH-
R_data = data.Radius;
Lc_data = data.Lc;
e_data = data.('e (%)'); % Referencing the column name with special characters
y_data = data.DWI_PCA_Predicted;

% REPLACE_WITH_DASH_DASH- 3. Fit a Second-Order Polynomial Surrogate Model REPLACE_WITH_DASH_DASH-
% A second-order polynomial is a good choice as it is a single, explicit
% mathematical equation that can approximate the non-linear behavior of an
% XGBoost model. It includes linear, quadratic, and interaction terms.
mdl = fitlm(table(R_data, Lc_data, e_data, y_data, 'VariableNames', {'R', 'Lc', 'e', 'y'}), 'y ~ R*Lc + R*e + Lc*e + R^2 + Lc^2 + e^2');

fprintf('\nSurrogate Model (Second-Order Polynomial):\n');
disp(mdl);

% REPLACE_WITH_DASH_DASH- Add code to display the regression equation as a string REPLACE_WITH_DASH_DASH-
fprintf('\nRegression Equation:\n');
coeffs = mdl.Coefficients;

% Start the string with the intercept term.
equation_str = sprintf('y = %.4f', coeffs.Estimate(1));

% Loop through the rest of the coefficients
for i = 2:size(coeffs, 1)
    % Get the coefficient estimate and its name
    estimate = coeffs.Estimate(i);
    term_name = coeffs.Properties.RowNames{i};
    
    % Clean up the term name for display (e.g., 'R:Lc' to 'R*Lc', 'R^2' to 'R^2')
    term_name = strrep(term_name, ':', '*');
    
    % Format the term based on its sign
    if estimate >= 0
        term_str = sprintf(' + %.4f * %s', estimate, term_name);
    else
        term_str = sprintf(' - %.4f * %s', abs(estimate), term_name);
    end
    equation_str = [equation_str, term_str];
end
fprintf('%s\n\n', equation_str);

% REPLACE_WITH_DASH_DASH- 4. Assess and Report Model Accuracy REPLACE_WITH_DASH_DASH-
R2_surrogate = mdl.Rsquared.Ordinary;
RMSE_surrogate = mdl.RMSE;

fprintf('Statistical Metrics for Surrogate Model:\n');
fprintf('  R-squared (R^2): %.4f\n', R2_surrogate);
fprintf('  Root Mean Squared Error (RMSE): %.4f\n\n', RMSE_surrogate);

% REPLACE_WITH_DASH_DASH- 5. Generate an Interactive 2D Nomograph Plot REPLACE_WITH_DASH_DASH-
figure('Name', 'Interactive 2D Nomograph', 'NumberTitle', 'off', 'Position', [100, 100, 1000, 700]);
ax = axes('Parent', gcf, 'Units', 'normalized', 'OuterPosition', [0.1, 0.2, 0.8, 0.7]);
hold(ax, 'on');
grid(ax, 'on');
box(ax, 'on');
xlabel(ax, 'Radius (R)');
ylabel(ax, 'Lc (Ls)');
title(ax, 'Interactive Nomograph for DWI_PCA_Predicted');
set(ax, 'FontSize', 12);

R_range = linspace(min(R_data), max(R_data), 50);
Lc_range = linspace(min(Lc_data), max(Lc_data), 50);
e_range = linspace(min(e_data), max(e_data), 50);

[R_grid, Lc_grid] = meshgrid(R_range, Lc_range);

% Create slider for 'e' variable
e_slider = uicontrol('Parent', gcf, 'Style', 'slider', 'Min', min(e_data), 'Max', max(e_data), ...
    'Value', median(e_data), 'Position', [200, 50, 600, 20]);
e_slider_label = uicontrol('Parent', gcf, 'Style', 'text', 'Position', [100, 50, 80, 20], 'String', 'e (%)');
e_slider_value = uicontrol('Parent', gcf, 'Style', 'text', 'Position', [810, 50, 80, 20], 'String', sprintf('%.2f', median(e_data)));

% Create the plot container
h_plot = surf(ax, R_grid, Lc_grid, zeros(size(R_grid))); % Initialize with zero height
set(h_plot, 'EdgeColor', 'none', 'FaceColor', 'interp');

% Callback function for the slider to update the plot
e_slider.Callback = @(src, event) updateNomograph2D(src.Value, R_grid, Lc_grid, mdl, ax, e_slider_value, h_plot);

% Initial plot
current_e = median(e_data);
updateNomograph2D(current_e, R_grid, Lc_grid, mdl, ax, e_slider_value, h_plot);

% The updateNomograph2D function for the 2D plot
function updateNomograph2D(e_value, R_grid, Lc_grid, mdl, ax, e_slider_value_handle, h_plot_handle)
    % Calculate the predicted DWI_PCA values for the current 'e' value
    e_grid = repmat(e_value, size(R_grid));
    
    % Use the surrogate model to predict the DWI_PCA values
    y_pred = predict(mdl, table(R_grid(:), Lc_grid(:), e_grid(:), 'VariableNames', {'R', 'Lc', 'e'}));
    y_pred_grid = reshape(y_pred, size(R_grid));
    
    % Update the plot data
    set(h_plot_handle, 'ZData', y_pred_grid, 'CData', y_pred_grid);
    
    % Get the fitted values to determine the consistent color scale
    fitted_values = mdl.Fitted;
    caxis(ax, [min(fitted_values), max(fitted_values)]);
    
    % Add the color bar to act as the third axis for the predicted values
    h_cb = colorbar(ax, 'Location', 'eastoutside');
    ylabel(h_cb, 'Predicted DWI_PCA', 'FontSize', 12);
    colormap(ax, 'jet');
    
    % Set plot properties
    xlabel(ax, 'Radius (R)');
    ylabel(ax, 'Lc (Ls)');
    title(ax, sprintf('Nomograph for DWI_PCA_Predicted (e = %.2f %%)', e_value));
    
    % Update the slider value text
    set(e_slider_value_handle, 'String', sprintf('%.2f', e_value));
end
##### SOURCE END #####
-->
</div></body></html>